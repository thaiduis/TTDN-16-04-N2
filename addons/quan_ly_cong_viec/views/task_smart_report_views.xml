<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- ========================================
         FORM VIEW: Smart Report Wizard
         ======================================== -->
    <record id="view_task_smart_report_wizard" model="ir.ui.view">
        <field name="name">task.smart.report.wizard</field>
        <field name="model">task.smart.report</field>
        <field name="arch" type="xml">
            <form string="B√°o c√°o Ti·∫øn ƒë·ªô Th√¥ng minh">
                <header>
                    <button name="action_submit_and_auto_tick" 
                            string="üì§ G·ª≠i B√°o c√°o" 
                            type="object" 
                            class="oe_highlight"
                            attrs="{'invisible': [('report_content', '=', False)]}"/>
                    <button string="H·ªßy" special="cancel" class="btn-secondary"/>
                </header>
                <sheet>
                    <div class="alert alert-info" role="alert">
                        <strong>üí° M·∫πo:</strong> Vi·∫øt t·ª± nhi√™n nh∆∞ "H√¥m nay t√¥i ƒë√£ ho√†n th√†nh thi·∫øt k·∫ø UI, code backend". 
                        AI s·∫Ω t·ª± ƒë·ªông tick checklist v√† t√≠nh % ho√†n th√†nh!
                    </div>
                    
                    <group>
                        <group>
                            <field name="task_id" invisible="1"/>
                            <field name="report_date"/>
                            <field name="time_spent"/>
                        </group>
                        <group>
                            <field name="progress_percentage" widget="progressbar" readonly="1"/>
                            <p class="text-muted">
                                <i>‚ú® % t·ª± ƒë·ªông t√≠nh t·ª´ checklist</i>
                            </p>
                        </group>
                    </group>
                    
                    <notebook>
                        <page string="üìù N·ªôi dung B√°o c√°o">
                            <group>
                                <field name="report_content" 
                                       placeholder="VD: H√¥m nay t√¥i ƒë√£ ho√†n th√†nh l√™n k·∫ø ho·∫°ch chi ti·∫øt v√† chu·∫©n b·ªã t√†i nguy√™n. B·∫Øt ƒë·∫ßu th·ª±c hi·ªán c√¥ng vi·ªác ch√≠nh ƒë∆∞·ª£c 30%..."
                                       nolabel="1"
                                       widget="text"/>
                            </group>
                            
                            <group>
                                <field name="attachment_ids" widget="many2many_binary" nolabel="1"/>
                            </group>
                        </page>
                        
                        <page string="‚úÖ Checklist Task" name="checklist_page">
                            <div class="alert alert-success" role="alert">
                                <strong>ü§ñ AI Auto-tick:</strong> Khi b·∫°n g·ª≠i b√°o c√°o, AI s·∫Ω t·ª± ƒë·ªông tick c√°c c√¥ng vi·ªác ƒë√£ ho√†n th√†nh!
                            </div>
                            
                            <field name="checklist_ids" nolabel="1">
                                <tree editable="bottom" decoration-success="is_done==True">
                                    <field name="sequence" widget="handle"/>
                                    <field name="is_done" widget="boolean_toggle" readonly="1"/>
                                    <field name="name"/>
                                    <field name="weight" optional="hide"/>
                                    <field name="estimated_hours" widget="float_time" optional="hide"/>
                                    <field name="ai_suggested" invisible="1"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>
                <footer>
                    <!-- Empty footer to hide default Save/Discard buttons -->
                </footer>
            </form>
        </field>
    </record>

    <!-- ========================================
         TREE VIEW: Smart Report List
         ======================================== -->
    <record id="view_task_smart_report_tree" model="ir.ui.view">
        <field name="name">task.smart.report.tree</field>
        <field name="model">task.smart.report</field>
        <field name="arch" type="xml">
            <tree decoration-danger="blocker_detected">
                <field name="report_date"/>
                <field name="task_id"/>
                <field name="user_id"/>
                <field name="progress_percentage" widget="progressbar"/>
                <field name="time_spent"/>
                <field name="sentiment_score"/>
                <field name="blocker_detected"/>
                <button name="action_mark_as_blocker" 
                        type="object" 
                        icon="fa-exclamation-triangle"
                        string="ƒê√°nh d·∫•u V∆∞·ªõng m·∫Øc"
                        attrs="{'invisible': [('blocker_detected', '=', True)]}"/>
            </tree>
        </field>
    </record>

    <!-- ========================================
         SEARCH VIEW
         ======================================== -->
    <record id="view_task_smart_report_search" model="ir.ui.view">
        <field name="name">task.smart.report.search</field>
        <field name="model">task.smart.report</field>
        <field name="arch" type="xml">
            <search>
                <field name="task_id"/>
                <field name="user_id"/>
                <filter string="C√≥ V∆∞·ªõng m·∫Øc" name="blocked" domain="[('blocker_detected', '=', True)]"/>
                <filter string="Ti√™u c·ª±c" name="negative" domain="[('sentiment_score', '=', 'negative')]"/>
                <group expand="1" string="Nh√≥m theo">
                    <filter string="Task" name="group_task" context="{'group_by':'task_id'}"/>
                    <filter string="Ng∆∞·ªùi b√°o c√°o" name="group_user" context="{'group_by':'user_id'}"/>
                    <filter string="Ng√†y" name="group_date" context="{'group_by':'report_date:day'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- ========================================
         ACTION
         ======================================== -->
    <record id="action_task_smart_report" model="ir.actions.act_window">
        <field name="name">B√°o c√°o Ti·∫øn ƒë·ªô</field>
        <field name="res_model">task.smart.report</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{'search_default_group_task': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Ch∆∞a c√≥ b√°o c√°o n√†o
            </p>
            <p>
                Nh√¢n vi√™n s·∫Ω b√°o c√°o ti·∫øn ƒë·ªô c√¥ng vi·ªác t·∫°i ƒë√¢y. 
                AI s·∫Ω t·ª± ƒë·ªông ph√¢n t√≠ch v√† ph√°t hi·ªán r·ªßi ro.
            </p>
        </field>
    </record>

</odoo>
